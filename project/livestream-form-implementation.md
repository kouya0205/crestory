# PickBuy ライブ配信作成/編集フォーム実装計画

## 1. 要件定義

### 基本機能

- ライブ配信の新規作成
- 既存ライブ配信の編集
- 配信のプレビュー
- 配信予約と即時開始

### 入力項目

- 基本情報

  - タイトル
  - 説明文
  - カバー画像（サムネイル）
  - 配信予定日時
  - 配信終了予定時間（オプション）

- 配信設定

  - 配信形式（縦型/横型）
  - 配信品質設定
  - 公開範囲（公開/限定公開/非公開）
  - コメント設定（許可/モデレーション/禁止）

- 商品連携

  - 関連商品の選択（複数選択可）
  - 表示順序の設定
  - 特別価格・割引の設定
  - タイムスタンプ連動設定（いつ商品を表示するか）

- 通知設定
  - 事前通知の有無
  - 通知タイミング（開始〇分前など）
  - 通知対象（フォロワー全員/特定グループ）

## 2. 画面設計

### 1. ライブ配信フォームのレイアウト

- マルチステップフォーム
  - Step 1: 基本情報入力
  - Step 2: 配信設定
  - Step 3: 商品連携
  - Step 4: 通知設定
  - Step 5: 確認・保存

### 2. 主要コンポーネント

- フォームステッパー（進行状況表示）
- 画像アップローダー
- 日時選択カレンダー
- 商品検索・選択コンポーネント
- ドラッグ&ドロップで並べ替え可能な商品リスト
- プレビュー表示エリア

## 3. 技術実装計画

### フロントエンド

- フォームライブラリ: `react-hook-form`
- バリデーション: `zod`
- UI コンポーネント: 既存の UI ライブラリに加えて必要なカスタムコンポーネント
- 画像アップロード: クライアントサイドでのプレビューと圧縮
- 状態管理: フォーム内は react-hook-form、グローバル状態は必要に応じて Context API

### バックエンド

- API エンドポイント:

  - POST /api/livestreams - 新規作成
  - PUT /api/livestreams/:id - 既存配信の更新
  - GET /api/products - 商品検索用
  - POST /api/upload - 画像アップロード用

- データベース更新:
  - LiveStream モデルの拡張（新しい設定フィールドの追加）
  - LiveStream と Product の関連付けの強化

### 画像ストレージ

- 一時ストレージと永続ストレージの分離
- 画像最適化（サムネイル生成、圧縮）
- CDN 連携（本番環境）

## 4. 実装ステップ

1. **準備フェーズ**

   - 必要なライブラリのインストール
   - API エンドポイントの設計
   - データモデルの拡張・調整

2. **UI 実装フェーズ**

   - 基本フォームレイアウト実装
   - 各ステップのフォームコンポーネント実装
   - バリデーション実装
   - 画像アップロードコンポーネント実装
   - 商品選択インターフェース実装

3. **API 連携フェーズ**

   - フォームデータの送信処理実装
   - 画像アップロード API 連携
   - 商品検索 API 連携
   - エラーハンドリング実装

4. **機能拡張フェーズ**

   - プレビュー機能実装
   - 下書き保存機能実装
   - 配信ステータス管理実装
   - 通知設定連携実装

5. **テスト・最適化フェーズ**
   - フォーム入力テスト
   - エッジケースのハンドリング
   - パフォーマンス最適化
   - レスポンシブデザイン調整

## 5. ルーティング設計

- `/dashboard/livestreams/new` - 新規作成フォーム
- `/dashboard/livestreams/edit/:id` - 編集フォーム
- `/dashboard/livestreams/:id/preview` - プレビュー画面

## 6. コンポーネント設計

- `LivestreamForm` - フォームのメインコンテナ
- `BasicInfoStep` - 基本情報入力ステップ
- `StreamSettingsStep` - 配信設定ステップ
- `ProductLinkStep` - 商品連携ステップ
- `NotificationStep` - 通知設定ステップ
- `ConfirmationStep` - 確認・保存ステップ
- `ImageUploader` - 画像アップロードコンポーネント
- `ProductSelector` - 商品検索・選択コンポーネント
- `ProductOrderList` - 商品並べ替えリスト
- `StreamPreview` - 配信プレビューコンポーネント

## 7. 考慮すべき追加機能

- リアルタイムでの下書き保存
- テンプレート機能（以前の配信設定の再利用）
- 定期配信設定
- AI による配信タイトル・説明文の提案
- 配信開始直前リマインダー
- 緊急時の配信中断・再開機能
