# 自分史（じぶんし）

自分史は、個人の人生の出来事やエピソードを記録・共有できるデジタル自分史作成プラットフォームです。家族との思い出の共有や、人生の振り返りをサポートします。

## プロジェクト概要

### サービス概要

自分史は、ユーザーが自分の人生のエピソードを記録し、家族と共有できるプラットフォームです。AIアシスタント機能により、思い出の記録をより豊かで詳細なものにすることができます。

### 主要機能

#### B. 自分史作成・編集機能

- **[MVP-B-001] 自分史エピソード作成**

  - タイトル入力
  - 日付入力（出来事のあった日、または記録日）
  - 本文入力（リッチテキストエディタ：太字、斜体、箇条書きなど基本的な書式設定）
  - ライフイベントタグ選択（「誕生」「学生時代」「就職」「結婚」「出産」「趣味」「旅行」「転機」など）

- **[MVP-B-002] 画像アップロード機能**

  - 1エピソードにつき複数枚の画像をアップロード可能
  - ファイルサイズ・総容量に上限設定

- **[MVP-B-003] AIによる簡易キャプション提案**

  - アップロードされた画像の内容をAIが解析
  - キャプションの候補を数パターン提示（ユーザーが選択・編集可能、ON/OFF設定）

- **[MVP-B-004] AIインタビュアー（ライト版）**

  - 特定のテーマやライフイベントに関する基本的な質問セットをAIが提示
  - ユーザーの回答に対し、AIがさらに簡単な深掘り質問を返すことで記述を促進

- **[MVP-B-005] エピソードの編集・削除機能**
- **[MVP-B-006] 下書き保存機能**

#### C. 自分史閲覧機能

- **[MVP-C-001] マイ自分史一覧表示**：時系列、またはライフイベントタグで絞り込んで一覧表示
- **[MVP-C-002] エピソード詳細表示**：テキストと画像を含めたエピソード内容の表示
- **[MVP-C-003] 家族の自分史一覧表示**：共有設定された家族メンバーの自分史エピソードを一覧表示
- **[MVP-C-004] 家族のエピソード詳細表示**

#### D. 共有・公開設定機能

- **[MVP-D-001] 自分史全体のデフォルト公開範囲設定**：「自分のみ」「家族のみ」の2段階から選択
- **[MVP-D-002] エピソードごとの公開範囲設定**：エピソード単位で「自分のみ」「家族のみ」を選択可能
- **[MVP-D-003] 家族IDの発行・表示**：ユーザーごとに一意の「家族ID」を発行し、表示
- **[MVP-D-004] 家族メンバーの登録・招待**
  - 他のユーザーの「家族ID」を入力して家族申請を送る
  - 家族申請の承認・拒否機能
  - 登録された家族メンバーの一覧表示
- **[MVP-D-005] 家族内での情報アクセス制御**：家族メンバーが閲覧できるのは「家族のみ」に公開設定したエピソードのみ

#### E. その他

- **[MVP-E-001] 利用規約・プライバシーポリシーの表示**
- **[MVP-E-002] ヘルプ・FAQページ（簡易版）**
- **[MVP-E-003] お問い合わせフォーム**

## 技術スタック

- [Next.js](https://nextjs.org) - Reactフレームワーク
- [NextAuth.js](https://next-auth.js.org) - 認証システム
- [Prisma](https://prisma.io) - データベースORM
- [Tailwind CSS](https://tailwindcss.com) - スタイリング
- [tRPC](https://trpc.io) - タイプセーフなAPI
- [Radix UI](https://www.radix-ui.com/) - UIコンポーネント
- [Framer Motion](https://www.framer.com/motion/) - アニメーション
- **画像ストレージ**: Vercel Blob (本番環境) / ローカルファイルシステム (開発環境)

## ルーティング構造

### 認証ページ

- `/` : ランディングページ
- `/auth/signin` : ログインページ
- `/auth/signup` : 新規登録ページ

### メインアプリケーションページ（ログイン後アクセス）

- `/app` : ダッシュボード（マイ自分史エピソード一覧の初期表示）
- `/app/profile` : プロフィール編集ページ
- `/app/stories/new` : 自分史エピソード新規作成ページ
- `/app/stories/[storyId]` : 自分史エピソード詳細表示ページ（自分のエピソード）
- `/app/stories/[storyId]/edit` : 自分史エピソード編集ページ
- `/app/family` : 家族管理ページ
  - 自分の家族ID表示
  - 家族メンバー登録（他ユーザーの家族ID入力）
  - 家族申請の承認/拒否
  - 登録済み家族メンバー一覧
- `/app/family/[familyMemberUserId]/stories` : 共有された家族メンバーの自分史エピソード一覧ページ
- `/app/family/[familyMemberUserId]/stories/[storyId]` : 共有された家族メンバーの自分史エピソード詳細表示ページ

### その他静的ページ

- `/terms` : 利用規約ページ
- `/privacy` : プライバシーポリシーページ
- `/help` : ヘルプ/FAQページ
- `/contact` : お問い合わせページ

## 開発環境のセットアップ

1. リポジトリのクローン

```bash
git clone https://github.com/your-username/jibunshi.git
cd jibunshi
```

2. 依存関係のインストール

```bash
npm install
```

3. 環境変数の設定
   `.env`ファイルを作成し、必要な環境変数を設定してください。

4. データベースのセットアップ

```bash
npm run db:generate
npm run db:push
```

5. 開発サーバーの起動

```bash
npm run dev
```

## デプロイメント

このプロジェクトは以下のプラットフォームにデプロイ可能です：

- [Vercel](https://vercel.com)
- [Netlify](https://netlify.com)
- [Docker](https://docker.com)

詳細なデプロイメント手順については、各プラットフォームのドキュメントを参照してください。

## ディレクトリ構成

```
src/
├── app/                  # App Router (Next.js 13+)
│   ├── api/             # API Routes
│   ├── stories/         # ストーリー関連ページ
│   └── page.tsx         # メインダッシュボード
├── components/          # Reactコンポーネント
│   └── ui/             # UI共通コンポーネント
├── lib/                # ユーティリティ
├── server/             # サーバーサイド処理
│   ├── api/            # tRPC Router
│   └── auth/           # 認証設定
└── trpc/               # tRPCクライアント設定
```

## 開発ガイド

### 画像アップロード機能

1. **遅延アップロード**: エディタで画像を追加した時点では一時的なBlob URLを使用し、保存ボタン押下時に実際のアップロードを実行
2. **画像編集**: 選択した画像に対して数値入力とドラッグでのリサイズが可能
3. **バリデーション**: ファイルサイズ（10MB以下）とファイル形式（JPEG, PNG, WebP, GIF）を検証

### データベース構造

- `Story`: エピソード本体
- `Image`: アップロード画像の管理
- `StoryImage`: エピソードと画像の関連付け（表示サイズ情報も含む）
- `Family`: 家族グループ管理
- `FamilyMembership`: 家族メンバーの招待・承認状態

## トラブルシューティング

### 画像アップロードエラー

1. **Vercel Blob設定エラー**: `BLOB_READ_WRITE_TOKEN`が正しく設定されているか確認
2. **開発環境での動作**: ローカルファイルシステムにフォールバックするため、`public/uploads`フォルダが作成されているか確認
3. **ファイルサイズエラー**: 10MB以下の画像ファイルを使用

### データベース接続エラー

1. PostgreSQLコンテナが起動しているか確認: `docker ps`
2. 環境変数`DATABASE_URL`が正しく設定されているか確認
3. マイグレーションが実行されているか確認: `npm run db:generate`

## ライセンス

MIT License
